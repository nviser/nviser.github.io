function dataFactory(){var t=[{name:"First item with custom name",id:1,quantity:2,comments:[{comment:"Totally agreed with owner, it's cool"},{comment:"Yeah, but not cheap.."}]},{name:"Second item is active",id:2,quantity:3,comments:[{comment:"I'm not shure"},{comment:"+1"},{comment:"Ok"}]},{name:"Third item",id:3,quantity:2,comments:[{comment:"Ask my partner asap"},{comment:"I'll be waiting"}]}];return t}function actFactory(){var t={add:function(t){var e=0,n=JSON.parse(localStorage.getItem("items"));return angular.forEach(n,function(t){t.id>e&&(e=t.id)}),n.push({name:t,id:e+1,quantity:0,comments:[]}),localStorage.setItem("items",JSON.stringify(n)),n},"delete":function(t){var e,n=JSON.parse(localStorage.getItem("items"));return angular.forEach(n,function(n,m){n.id==t.id&&(e=m)}),n.splice(e,1),localStorage.setItem("items",JSON.stringify(n)),n},newComment:function(t,e){var n=JSON.parse(localStorage.getItem("items"));return angular.forEach(n,function(m,a){m.id==t&&(n[a].comments.push({comment:e}),n[a].quantity++)}),localStorage.setItem("items",JSON.stringify(n)),n}};return t}var app=angular.module("mainApp",[]);app.run(function(){if(void 0==localStorage.getItem("items")){var t=JSON.stringify(dataFactory());localStorage.setItem("items",t)}}),app.controller("mainCtrl",["$scope","$timeout",function(t){var e=JSON.parse(localStorage.getItem("items"));t.items=e,t.init=function(){0===t.items.length?(t.curItemComments=[],t.id=""):(t.curItemComments=e[0].comments,t.id=e[0].id)},t.init(),t.addItem=function(){t.newItem&&(t.items=actFactory().add(t.newItem),t.newItem="",1==t.items.length&&t.details(t.items[0]))},t.deleteItem=function(e){var n=confirm("Are you sure want to delete this item?");n&&(t.items=actFactory().delete(e),t.refresh(t.items,e.id,!0,e))},t.details=function(e){t.curItemComments=e.comments,t.id=e.id},t.addComment=function(e){t.newComment&&(t.items=actFactory().newComment(e,t.newComment),t.refresh(t.items,e,!1),t.newComment="")},t.refresh=function(e,n,m,a){return e.length?m&&t.id==a.id?void t.details(t.items[0]):void angular.forEach(e,function(m,a){m.id==n&&(t.curItemComments=e[a].comments)}):(t.curItemComments=[],void(t.id=""))},t.subm=function(e,n){13==e.keyCode&&(e.preventDefault(),t.addComment(n))}}]),app.factory("dataFactory",dataFactory),app.service("actFactory",actFactory);